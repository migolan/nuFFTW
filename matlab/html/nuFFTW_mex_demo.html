
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>nuFFTW mex interface demo</title><meta name="generator" content="MATLAB 8.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2013-09-03"><meta name="DC.source" content="nuFFTW_mex_demo.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>nuFFTW mex interface demo</h1><p>This example demonstrates how to use the mex interface of the nuFFTW.</p><p>Before reading this, you should familiarize yourself with the nuFFTW mex interface by reading the nuFFTW mex interface overview (nuFFTW_mex_overview.html) and the nuFFT mex interface demo (nuFFT_mex_demo.html).</p><p>nuFFTW is an auto-tuning, parallel library for computation of non-uniform fast Fourier transforms (nuFFTs). It provides the possibility to create an nuFFT implementation with the highest performance for a given level of gridding accuracy. To that end, we define a space of error-equivalent nuFFT implementations with different oversampling ratios (alpha). This space is specified by a minimum and maximum oversampling ratio (\alpha), and the number of implementations to be checked.</p><pre class="codeinput">addpath <span class="string">../bin</span>
load <span class="string">../data/spiral2d_phantom.mat</span>
trajectory = kcoord';
trajectory = trajectory(:);
sqrtdcf = sqrt(dcf);
Nthreads = 1;
imagesize = [128 128];
maxaliasingerror = 1e-3;
alphamin = 1.2;
alphamax = 2;
Nalpha = 20;
resampling_method = <span class="string">'spm'</span>;
tuning_heuristic = <span class="string">'nufft'</span>;
</pre><p>Tune the nuFFT implementation space:</p><pre class="codeinput">nuFFT_imp = nufftw(<span class="string">'double'</span>, Nthreads, imagesize, maxaliasingerror, alphamin, alphamax, Nalpha, resampling_method, tuning_heuristic, trajectory, sqrtdcf);
</pre><pre class="codeoutput">initializing external libraries: 0.017909s
implementation no. 0
computing implementation data: 0.24705s
tuning: 0.0154111s
adjoint transformation: 0.00511885s
adjoint transformation: 0.00503707s
adjoint transformation: 0.00493503s
adjoint transformation: 0.00477386s
adjoint transformation: 0.00658703s
adjoint transformation: 0.00793314s
adjoint transformation: 0.00614095s
adjoint transformation: 0.00501084s
adjoint transformation: 0.00475597s
adjoint transformation: 0.00485516s
average runtime: 0.00551479s
implementation no. 1
computing implementation data: 0.198205s
tuning: 0.013793s
adjoint transformation: 0.00488496s
adjoint transformation: 0.00427198s
adjoint transformation: 0.00403905s
adjoint transformation: 0.00418496s
adjoint transformation: 0.00450015s
adjoint transformation: 0.00410295s
adjoint transformation: 0.0040071s
adjoint transformation: 0.00409794s
adjoint transformation: 0.00404406s
adjoint transformation: 0.00475883s
average runtime: 0.0042892s
deleting nuFFT implementation
implementation no. 2
computing implementation data: 0.178312s
tuning: 0.015059s
adjoint transformation: 0.00485897s
adjoint transformation: 0.00485802s
adjoint transformation: 0.00482082s
adjoint transformation: 0.00481486s
adjoint transformation: 0.00503802s
adjoint transformation: 0.00489092s
adjoint transformation: 0.00496197s
adjoint transformation: 0.00490093s
adjoint transformation: 0.0048449s
adjoint transformation: 0.00481009s
average runtime: 0.00487995s
deleting nuFFT implementation
implementation no. 3
computing implementation data: 0.163709s
tuning: 0.012419s
adjoint transformation: 0.00493383s
adjoint transformation: 0.00447106s
adjoint transformation: 0.004704s
adjoint transformation: 0.00466585s
adjoint transformation: 0.0044229s
adjoint transformation: 0.00440884s
adjoint transformation: 0.00465202s
adjoint transformation: 0.00441408s
adjoint transformation: 0.0045619s
adjoint transformation: 0.00448298s
average runtime: 0.00457175s
deleting nuFFT implementation
implementation no. 4
computing implementation data: 0.152327s
tuning: 0.0126572s
adjoint transformation: 0.00454211s
adjoint transformation: 0.00424695s
adjoint transformation: 0.00451016s
adjoint transformation: 0.00423503s
adjoint transformation: 0.00422215s
adjoint transformation: 0.00420618s
adjoint transformation: 0.0042541s
adjoint transformation: 0.00424409s
adjoint transformation: 0.00423694s
adjoint transformation: 0.00424194s
average runtime: 0.00429397s
deleting nuFFT implementation
implementation no. 5
computing implementation data: 0.135183s
tuning: 0.0121791s
adjoint transformation: 0.00441098s
adjoint transformation: 0.00392699s
adjoint transformation: 0.00410795s
adjoint transformation: 0.00388098s
adjoint transformation: 0.00394797s
adjoint transformation: 0.00388694s
adjoint transformation: 0.00414395s
adjoint transformation: 0.00411415s
adjoint transformation: 0.00399709s
adjoint transformation: 0.00391316s
average runtime: 0.00403302s
deleting nuFFT implementation
implementation no. 6
computing implementation data: 0.135789s
tuning: 0.0120289s
adjoint transformation: 0.00559115s
adjoint transformation: 0.00485277s
adjoint transformation: 0.00490308s
adjoint transformation: 0.00479698s
adjoint transformation: 0.00483513s
adjoint transformation: 0.00481606s
adjoint transformation: 0.004807s
adjoint transformation: 0.00497985s
adjoint transformation: 0.00480986s
adjoint transformation: 0.00496197s
average runtime: 0.00493538s
deleting nuFFT implementation
implementation no. 7
computing implementation data: 0.124889s
tuning: 0.0110371s
adjoint transformation: 0.00542092s
adjoint transformation: 0.00452399s
adjoint transformation: 0.00449395s
adjoint transformation: 0.00454593s
adjoint transformation: 0.00451803s
adjoint transformation: 0.00471592s
adjoint transformation: 0.00450993s
adjoint transformation: 0.00476408s
adjoint transformation: 0.00449181s
adjoint transformation: 0.00447989s
average runtime: 0.00464644s
deleting nuFFT implementation
implementation no. 8
computing implementation data: 0.1175s
tuning: 0.0112541s
adjoint transformation: 0.00507498s
adjoint transformation: 0.00450301s
adjoint transformation: 0.00422406s
adjoint transformation: 0.00428295s
adjoint transformation: 0.00431895s
adjoint transformation: 0.0045259s
adjoint transformation: 0.00422692s
adjoint transformation: 0.00421596s
adjoint transformation: 0.00429511s
adjoint transformation: 0.00423503s
average runtime: 0.00439029s
deleting nuFFT implementation
implementation no. 9
computing implementation data: 0.115857s
tuning: 0.0105021s
adjoint transformation: 0.00479889s
adjoint transformation: 0.00385404s
adjoint transformation: 0.00379515s
adjoint transformation: 0.00375199s
adjoint transformation: 0.00384903s
adjoint transformation: 0.00374508s
adjoint transformation: 0.00381398s
adjoint transformation: 0.00380111s
adjoint transformation: 0.00442004s
adjoint transformation: 0.00380707s
average runtime: 0.00396364s
deleting nuFFT implementation
implementation no. 10
computing implementation data: 0.112942s
tuning: 0.0109429s
adjoint transformation: 0.0096488s
adjoint transformation: 0.0093751s
adjoint transformation: 0.00936604s
adjoint transformation: 0.0090971s
adjoint transformation: 0.00910902s
adjoint transformation: 0.00919604s
adjoint transformation: 0.00920892s
adjoint transformation: 0.0091691s
adjoint transformation: 0.00926399s
adjoint transformation: 0.00918317s
average runtime: 0.00926173s
deleting nuFFT implementation
implementation no. 11
computing implementation data: 0.108235s
tuning: 0.0111148s
adjoint transformation: 0.00550723s
adjoint transformation: 0.005059s
adjoint transformation: 0.00459504s
adjoint transformation: 0.00447893s
adjoint transformation: 0.00457096s
adjoint transformation: 0.00461006s
adjoint transformation: 0.00453806s
adjoint transformation: 0.00464487s
adjoint transformation: 0.00464797s
adjoint transformation: 0.00457406s
average runtime: 0.00472262s
deleting nuFFT implementation
implementation no. 12
computing implementation data: 0.104166s
tuning: 0.011204s
adjoint transformation: 0.00506616s
adjoint transformation: 0.00449514s
adjoint transformation: 0.00448513s
adjoint transformation: 0.00478005s
adjoint transformation: 0.00442314s
adjoint transformation: 0.00460386s
adjoint transformation: 0.00525999s
adjoint transformation: 0.00451684s
adjoint transformation: 0.00445294s
adjoint transformation: 0.00509095s
average runtime: 0.00471742s
deleting nuFFT implementation
implementation no. 13
computing implementation data: 0.101641s
tuning: 0.0121219s
adjoint transformation: 0.00650787s
adjoint transformation: 0.00617099s
adjoint transformation: 0.00626588s
adjoint transformation: 0.00624299s
adjoint transformation: 0.00597501s
adjoint transformation: 0.00599194s
adjoint transformation: 0.00598097s
adjoint transformation: 0.0060122s
adjoint transformation: 0.00633192s
adjoint transformation: 0.006078s
average runtime: 0.00615578s
deleting nuFFT implementation
implementation no. 14
computing implementation data: 0.0992322s
tuning: 0.011549s
adjoint transformation: 0.0117998s
adjoint transformation: 0.0111551s
adjoint transformation: 0.0113709s
adjoint transformation: 0.0112181s
adjoint transformation: 0.0112698s
adjoint transformation: 0.0112879s
adjoint transformation: 0.0111659s
adjoint transformation: 0.0111511s
adjoint transformation: 0.0112681s
adjoint transformation: 0.0112212s
average runtime: 0.0112908s
deleting nuFFT implementation
implementation no. 15
computing implementation data: 0.0956731s
tuning: 0.011256s
adjoint transformation: 0.00662899s
adjoint transformation: 0.00597s
adjoint transformation: 0.00599408s
adjoint transformation: 0.00617719s
adjoint transformation: 0.00594211s
adjoint transformation: 0.00592899s
adjoint transformation: 0.00615883s
adjoint transformation: 0.00591803s
adjoint transformation: 0.00592303s
adjoint transformation: 0.00590801s
average runtime: 0.00605493s
deleting nuFFT implementation
implementation no. 16
computing implementation data: 0.0925472s
tuning: 0.011615s
adjoint transformation: 0.00839496s
adjoint transformation: 0.00775099s
adjoint transformation: 0.00774288s
adjoint transformation: 0.0078969s
adjoint transformation: 0.00756288s
adjoint transformation: 0.00758004s
adjoint transformation: 0.00759006s
adjoint transformation: 0.00762391s
adjoint transformation: 0.00762796s
adjoint transformation: 0.00764108s
average runtime: 0.00774117s
deleting nuFFT implementation
implementation no. 17
computing implementation data: 0.0913329s
tuning: 0.0345831s
adjoint transformation: 0.00705099s
adjoint transformation: 0.00644708s
adjoint transformation: 0.00638199s
adjoint transformation: 0.00630903s
adjoint transformation: 0.00636315s
adjoint transformation: 0.00648785s
adjoint transformation: 0.00629592s
adjoint transformation: 0.00632811s
adjoint transformation: 0.00625205s
adjoint transformation: 0.00652599s
average runtime: 0.00644422s
deleting nuFFT implementation
implementation no. 18
computing implementation data: 0.087384s
tuning: 0.0109398s
adjoint transformation: 0.00784016s
adjoint transformation: 0.00717807s
adjoint transformation: 0.00713611s
adjoint transformation: 0.007092s
adjoint transformation: 0.00708914s
adjoint transformation: 0.00742388s
adjoint transformation: 0.00733495s
adjoint transformation: 0.00720787s
adjoint transformation: 0.00711894s
adjoint transformation: 0.00720787s
average runtime: 0.0072629s
deleting nuFFT implementation
implementation no. 19
computing implementation data: 0.084235s
tuning: 0.0108631s
adjoint transformation: 0.00616288s
adjoint transformation: 0.00541306s
adjoint transformation: 0.00555706s
adjoint transformation: 0.0056169s
adjoint transformation: 0.00543594s
adjoint transformation: 0.00537801s
adjoint transformation: 0.00559998s
adjoint transformation: 0.00541592s
adjoint transformation: 0.0054791s
adjoint transformation: 0.00554705s
average runtime: 0.00556059s
deleting nuFFT implementation
optimal implementation is no. 9
deleting nuFFT implementation
</pre><p>Note that the implementation counting is zero-based.</p><p>This implementation can now be used for nuFFTs:</p><pre class="codeinput">kdata_dc = kdata.*sqrtdcf;
imagenufft = nuFFT_imp.adjoint(1,kdata_dc);
e = get_image_errors(imagenudft,imagenufft);
figure
imshowz(imagenufft)
title(<span class="string">'adjoint nuFFT'</span>)
</pre><pre class="codeoutput">** adjoint nuFFT **
adjoint transformation: 0.00395179s
max error: 0.00074529
</pre><img vspace="5" hspace="5" src="nuFFTW_mex_demo_01.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2012b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% nuFFTW mex interface demo
% This example demonstrates how to use the mex interface of the nuFFTW.
%
% Before reading this, you should familiarize yourself with the nuFFTW mex
% interface by reading the nuFFTW mex interface overview
% (nuFFTW_mex_overview.html) and the nuFFT mex interface demo
% (nuFFT_mex_demo.html).
%
% nuFFTW is an auto-tuning, parallel library for computation of non-uniform
% fast Fourier transforms (nuFFTs). It provides the possibility to create
% an nuFFT implementation with the highest performance for a given level of
% gridding accuracy. To that end, we define a space of error-equivalent
% nuFFT implementations with different oversampling ratios (alpha).
% This space is specified by a minimum and maximum oversampling ratio
% (\alpha), and the number of implementations to be checked.

addpath ../bin
load ../data/spiral2d_phantom.mat
trajectory = kcoord';
trajectory = trajectory(:);
sqrtdcf = sqrt(dcf);
Nthreads = 1;
imagesize = [128 128];
maxaliasingerror = 1e-3;
alphamin = 1.2;
alphamax = 2;
Nalpha = 20;
resampling_method = 'spm';
tuning_heuristic = 'nufft';

%%
% Tune the nuFFT implementation space:
nuFFT_imp = nufftw('double', Nthreads, imagesize, maxaliasingerror, alphamin, alphamax, Nalpha, resampling_method, tuning_heuristic, trajectory, sqrtdcf);

%%
% Note that the implementation counting is zero-based.
%
% This implementation can now be used for nuFFTs:
kdata_dc = kdata.*sqrtdcf;
imagenufft = nuFFT_imp.adjoint(1,kdata_dc);
e = get_image_errors(imagenudft,imagenufft);
figure
imshowz(imagenufft)
title('adjoint nuFFT')


##### SOURCE END #####
--></body></html>